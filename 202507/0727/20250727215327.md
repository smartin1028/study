# 파이썬으로 H2 데이터베이스에 데이터 삽입하기

H2 데이터베이스는 자바로 작성된 경량 관계형 데이터베이스로, 파이썬에서 사용하기 위해서는 JDBC 드라이버를 통해 접근해야 합니다. 파이썬에서 H2 DB에 데이터를 삽입하는 방법을 단계별로 설명드리겠습니다.

## 1. 필요한 라이브러리 설치

먼저, 파이썬에서 JDBC를 사용할 수 있도록 `JayDeBeApi`와 `JPype1` 패키지를 설치합니다.

```bash
pip install JayDeBeApi JPype1
```

## 2. H2 JDBC 드라이버 다운로드

[H2 공식 웹사이트](https://www.h2database.com/html/main.html)에서 JDBC 드라이버를 다운로드합니다. (예: `h2-2.1.214.jar`)

## 3. 기본 연결 및 데이터 삽입 코드

```python
import jaydebeapi

# H2 데이터베이스 연결 정보 설정
db_url = "jdbc:h2:~/test"  # 사용자 홈 디렉토리에 test.mv.db 파일 생성
username = "sa"  # 기본 사용자명
password = ""    # 기본 비밀번호(공백)
driver = "org.h2.Driver"  # H2 JDBC 드라이버 클래스
jar_file = "h2-2.1.214.jar"  # 다운로드한 H2 JDBC 드라이버 경로

# 데이터베이스 연결
conn = jaydebeapi.connect(driver, db_url, [username, password], jar_file)

try:
    # 커서 생성
    cursor = conn.cursor()
    
    # 테이블 생성 (이미 존재하면 생략 가능)
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS users (
        id INT PRIMARY KEY,
        name VARCHAR(50),
        email VARCHAR(100),
        age INT
    )
    """)
    
    # 데이터 삽입 방법 1: 단일 레코드 삽입
    cursor.execute("INSERT INTO users (id, name, email, age) VALUES (1, '김철수', 'chulsoo@example.com', 30)")
    
    # 데이터 삽입 방법 2: 파라미터 바인딩 사용
    user_data = (2, '이영희', 'younghee@example.com', 28)
    cursor.execute("INSERT INTO users (id, name, email, age) VALUES (?, ?, ?, ?)", user_data)
    
    # 데이터 삽입 방법 3: 여러 레코드 한 번에 삽입
    users = [
        (3, '박민수', 'minsu@example.com', 35),
        (4, '정수진', 'soojin@example.com', 26),
        (5, '최동현', 'donghyun@example.com', 31)
    ]
    cursor.executemany("INSERT INTO users (id, name, email, age) VALUES (?, ?, ?, ?)", users)
    
    # 변경사항 커밋
    conn.commit()
    print("데이터 삽입 성공!")
    
except Exception as e:
    print(f"오류 발생: {e}")
    conn.rollback()
    
finally:
    # 연결 종료
    if 'cursor' in locals():
        cursor.close()
    if conn:
        conn.close()
```

## 4. 고급 사용 방법

### 트랜잭션 처리

```python
try:
    cursor = conn.cursor()
    # 여러 작업 수행
    cursor.execute("INSERT INTO table1 VALUES (...)")
    cursor.execute("UPDATE table2 SET ...")
    conn.commit()  # 모든 작업이 성공하면 커밋
except:
    conn.rollback()  # 오류 발생시 롤백
```

### AUTO_INCREMENT 컬럼 처리

```python
# 테이블 생성 시 AUTO_INCREMENT 설정
cursor.execute("""
CREATE TABLE products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2)
)
""")

# 데이터 삽입 시 ID 생략
cursor.execute("INSERT INTO products (name, price) VALUES (?, ?)", 
               ('노트북', 1200000))
```

## 5. 주의사항

1. H2 데이터베이스는 기본적으로 메모리 모드로 실행되며, 파일로 저장하려면 연결 URL을 `jdbc:h2:~/yourdbname` 형식으로 지정해야 합니다.
2. H2 서버 모드를 사용하려면 먼저 H2 서버를 별도로 실행해야 합니다.
3. 대량의 데이터를 삽입할 때는 `executemany()`를 사용하는 것이 성능상 유리합니다.
4. 연결 종료를 잊지 마세요. `with` 문을 사용하면 자동으로 처리됩니다.

이 코드를 기반으로 필요한 테이블 구조와 데이터에 맞게 수정하여 사용하시면 됩니다.