# Elasticsearch 연결 오류 해결: "x509: certificate signed by unknown authority"

이 오류는 Elasticsearch 클라이언트가 Elasticsearch 서버에 연결을 시도할 때 발생하는 SSL/TLS 인증서 검증 문제입니다. 아래에서 원인과 해결 방법을 상세히 설명드리겠습니다.

## 오류 원인 분석

```
Exiting: couldn't connect to any of the configured Elasticsearch hosts. 
Errors: [error connecting to Elasticsearch at https://localhost:9200: 
Get "https://localhost:9200": x509: certificate signed by unknown authority]
```

이 오류는 다음과 같은 상황에서 발생합니다:

1. Elasticsearch가 HTTPS를 사용하도록 구성되어 있음
2. 사용 중인 인증서가 자체 서명되었거나 신뢰할 수 있는 CA(인증 기관)에서 발급되지 않음
3. 클라이언트가 서버의 인증서를 신뢰하지 않음

## 해결 방법

### 1. 인증서 검증 비활성화 (개발 환경에서만 권장)

가장 빠른 해결 방법이지만 보안상 위험할 수 있으므로 개발 환경에서만 사용하세요.

```go
// Go 예시
config := elasticsearch.Config{
  Addresses: []string{"https://localhost:9200"},
  Transport: &http.Transport{
    TLSClientConfig: &tls.Config{
      InsecureSkipVerify: true, // 인증서 검증 비활성화
    },
  },
}
```

```python
# Python 예시
from elasticsearch import Elasticsearch

es = Elasticsearch(
  ['https://localhost:9200'],
  verify_certs=False  # 인증서 검증 비활성화
)
```

### 2. 신뢰할 수 있는 인증서 사용

1. 공인 CA에서 인증서를 발급받아 사용
2. Let's Encrypt와 같은 무료 인증서 서비스 이용

### 3. 자체 서명된 인증서를 신뢰할 수 있는 인증서로 추가

#### 클라이언트에 인증서 추가 (Go 예시)

```go
cert, _ := ioutil.ReadFile("/path/to/ca.crt")

certPool := x509.NewCertPool()
certPool.AppendCertsFromPEM(cert)

config := elasticsearch.Config{
  Addresses: []string{"https://localhost:9200"},
  Transport: &http.Transport{
    TLSClientConfig: &tls.Config{
      RootCAs: certPool,
    },
  },
}
```

#### curl로 테스트할 경우

```bash
curl --cacert /path/to/ca.crt https://localhost:9200
```

### 4. Elasticsearch 구성 변경

`elasticsearch.yml`에서 SSL 설정 확인:

```yaml
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: certs/elastic-certificates.p12
xpack.security.http.ssl.truststore.path: certs/elastic-certificates.p12
```

### 5. 인증서 생성 및 구성 (자체 서명된 경우)

1. 인증서 생성:
```bash
bin/elasticsearch-certutil ca
bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12
```

2. 생성된 인증서를 Elasticsearch 구성 디렉토리로 이동
3. `elasticsearch.yml`에 인증서 경로 지정

## 추가 확인 사항

1. Elasticsearch가 실제로 실행 중인지 확인:
   ```bash
   ps aux | grep elasticsearch
   ```

2. 올바른 포트에서 수신 중인지 확인:
   ```bash
   netstat -tuln | grep 9200
   ```

3. 방화벽 설정 확인:
   ```bash
   sudo ufw status
   ```

이 문제는 일반적으로 개발 환경에서 자체 서명된 인증서를 사용할 때 발생합니다. 프로덕션 환경에서는 항상 신뢰할 수 있는 CA에서 발급한 인증서를 사용하는 것이 좋습니다.