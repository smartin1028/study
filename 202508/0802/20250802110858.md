# Logstash 설치 및 실행 방법 (Elasticsearch 8.0 이상 버전)

## 1. 사전 요구 사항
- Java 11 또는 17 설치 필요 (OpenJDK 권장)
- 최소 4GB RAM (프로덕션 환경에서는 8GB 이상 권장)
- Elasticsearch 8.x 버전이 설치 및 실행 중이어야 함

## 2. Logstash 설치 방법

### Linux/macOS 설치
```bash
# Debian/Ubuntu
wget https://artifacts.elastic.co/downloads/logstash/logstash-8.x.x.deb
sudo dpkg -i logstash-8.x.x.deb

# RHEL/CentOS
wget https://artifacts.elastic.co/downloads/logstash/logstash-8.x.x.rpm
sudo rpm -ivh logstash-8.x.x.rpm

# macOS (Homebrew 사용)
brew tap elastic/tap
brew install elastic/tap/logstash-full
```

### Windows 설치
1. [Elastic 공식 사이트](https://www.elastic.co/downloads/logstash)에서 Windows ZIP 패키지 다운로드
2. 원하는 위치에 압축 해제 (예: `C:\Program Files\Logstash`)

## 3. Logstash 구성

### 기본 구성 파일 위치
- Linux: `/etc/logstash/`
- Windows: `C:\Program Files\Logstash\config`

### Elasticsearch 8.x 연결 설정
`logstash.conf` 파일 예시:
```conf
input {
  # 입력 플러그인 설정 (예: 파일 입력)
  file {
    path => "/var/log/*.log"
    start_position => "beginning"
  }
}

filter {
  # 필요한 필터 설정
  grok {
    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:loglevel} %{GREEDYDATA:message}" }
  }
}

output {
  # Elasticsearch 8.x 출력 설정
  elasticsearch {
    hosts => ["https://localhost:9200"]
    index => "logstash-%{+YYYY.MM.dd}"
    user => "elastic"
    password => "your_password"
    cacert => "/path/to/http_ca.crt"  # Elasticsearch 8.x는 기본적으로 HTTPS 사용
    ssl => true
    ssl_certificate_verification => true
  }
  
  # 디버깅을 위해 표준 출력에도 출력
  stdout { codec => rubydebug }
}
```

## 4. Logstash 실행 방법

### Linux/macOS
```bash
# 시스템 서비스로 실행 (systemd)
sudo systemctl start logstash

# 또는 직접 실행 (테스트용)
/usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf
```

### Windows
```powershell
# PowerShell에서 실행
cd "C:\Program Files\Logstash\bin"
.\logstash.bat -f "C:\Program Files\Logstash\config\logstash.conf"
```

## 5. Elasticsearch 8.x와의 보안 설정

Elasticsearch 8.0부터는 기본적으로 보안이 활성화되어 있습니다. 다음 설정이 필요합니다:

1. Elasticsearch에서 `http_ca.crt` 파일 위치 확인 (기본적으로 `config/certs` 디렉토리)
2. Logstash 구성에 SSL 인증서 경로 지정
3. 적절한 사용자 자격 증명 설정 (기본 사용자: elastic)

## 6. Logstash 플러그인 관리

```bash
# 플러그인 목록 확인
bin/logstash-plugin list

# 플러그인 설치 예시 (Elasticsearch 출력 플러그인)
bin/logstash-plugin install logstash-output-elasticsearch

# 플러그인 업데이트
bin/logstash-plugin update
```

## 7. 문제 해결

- **연결 문제**: `ssl_certificate_verification`을 `false`로 설정하여 테스트 (프로덕션에서는 권장하지 않음)
- **메모리 부족**: `jvm.options` 파일에서 힙 크기 조정 (기본값: 1GB)
- **로그 확인**: Linux의 경우 `/var/log/logstash/`, Windows의 경우 `logs` 디렉토리

## 8. 시스템 서비스 등록 (Linux)

```bash
sudo /usr/share/logstash/bin/system-install /etc/logstash/startup.options
sudo systemctl enable logstash
sudo systemctl start logstash
```

이제 Logstash가 Elasticsearch 8.x와 함께 작동할 준비가 되었습니다. 구성 파일을 수정한 후에는 Logstash 서비스를 재시작해야 변경 사항이 적용됩니다.