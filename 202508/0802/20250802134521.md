# Filebeat 처리 방식 및 Elasticsearch 표시 방법

## Filebeat의 처리 방식

Filebeat는 경량 로그 수집기로 다음과 같은 방식으로 작동합니다:

### 1. 입력 단계 (Inputs)
- **로그 파일 모니터링**: 지정된 경로의 로그 파일을 지속적으로 모니터링
- **파일 상태 추적**: `registry` 파일을 사용하여 각 로그 파일의 읽기 상태(오프셋) 추적
- **다양한 입력 소스 지원**: 로그 파일 외에도 syslog, Redis, Kafka 등 다양한 소스 지원

### 2. 처리 파이프라인 (Processing Pipeline)
- **하베스터(Harvester)**: 개별 파일을 열고 내용을 읽는 프로세스
- **이벤트 생성**: 읽은 각 로그 라인을 이벤트로 변환
- **필드 추가**: 호스트명, 타임스탬프 등 메타데이터 추가
- **프로세서 적용**: 필요에 따라 다음 프로세서들 적용 가능:
  - `add_cloud_metadata`: 클라우드 인스턴스 메타데이터 추가
  - `add_docker_metadata`: Docker 컨테이너 정보 추가
  - `decode_json_fields`: JSON 형식 로그 파싱
  - `drop_event`: 특정 조건의 이벤트 삭제
  - `grok`: 비정형 로그 구조화

### 3. 출력 단계 (Outputs)
- **Elasticsearch 전송**: 처리된 이벤트를 Elasticsearch로 전송
- **대체 출력 지원**: Logstash, Kafka, Redis 등으로도 전송 가능
- **배치 처리**: 이벤트를 모아 일정 크기 또는 시간 간격으로 배치 전송
- **재시도 메커니즘**: 전송 실패 시 자동 재시도

## Elasticsearch에서의 표시 방식

Filebeat가 Elasticsearch에 데이터를 전송하면 다음과 같이 표시됩니다:

### 1. 인덱스 패턴
- 기본 형식: `filebeat-7.15.1-2023.01.01-000001` (버전과 날짜 기반)
- 일일 롤링 인덱스가 기본 설정
- ILM(Index Lifecycle Management)으로 수명 주기 관리 가능

### 2. 문서 구조
```json
{
  "@timestamp": "2023-01-01T12:00:00.000Z",
  "agent": {
    "hostname": "webserver-01",
    "id": "a1b2c3d4-e5f6-7890",
    "type": "filebeat",
    "version": "7.15.1"
  },
  "log": {
    "file": {
      "path": "/var/log/nginx/access.log"
    },
    "offset": 123456
  },
  "message": "192.168.1.1 - - [01/Jan/2023:12:00:00 +0000] \"GET / HTTP/1.1\" 200 612",
  "fields": {
    "env": "production"
  },
  "ecs": {
    "version": "1.12.0"
  }
}
```

### 3. 주요 필드 설명
- **@timestamp**: 이벤트 발생 시간
- **agent**: Filebeat 에이전트 정보
- **host**: 로그가 수집된 호스트 정보
- **log**: 로그 파일 경로 및 오프셋 정보
- **message**: 원본 로그 메시지
- **fields**: 사용자 정의 필드
- **ECS(Elastic Common Schema)**: 표준화된 필드 구조

### 4. Kibana에서의 활용
- **Discover**: 로그 데이터 탐색 및 검색
- **Dashboard**: 시각화 생성
- **Machine Learning**: 이상 감지
- **Alerting**: 로그 기반 알림 설정

## 고급 설정 옵션

1. **인덱스 템플릿**: Filebeat가 자동으로 Elasticsearch에 인덱스 템플릿 제공
2. **Ingest Pipeline**: Elasticsearch에서 추가 처리 가능
3. **모듈 기능**: Nginx, MySQL 등 특정 애플리케이션에 최적화된 사전 설정 제공

Filebeat는 경량 설계로 리소스 사용이 적으면서도 대량의 로그 데이터를 효율적으로 처리하고 Elasticsearch에 구조화된 형태로 저장할 수 있게 해줍니다.