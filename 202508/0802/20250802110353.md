# Logstash 설치 및 실행 방법

Logstash는 데이터 수집, 변환 및 전송을 위한 오픈소스 도구로, ELK 스택(Elasticsearch, Logstash, Kibana)의 핵심 구성 요소입니다. 아래에 상세한 설치 및 실행 방법을 안내드립니다.

## 1. 시스템 요구사항 확인
- Java 8 또는 11 설치 필요 (OpenJDK 또는 Oracle JDK)
- 최소 2GB RAM 권장 (대량 데이터 처리 시 4GB 이상)
- x86_64 또는 ARM 아키텍처 지원

## 2. Java 설치 확인
```bash
java -version
```
Java가 설치되지 않은 경우:
- Ubuntu/Debian: `sudo apt install openjdk-11-jdk`
- CentOS/RHEL: `sudo yum install java-11-openjdk`

## 3. Logstash 설치 방법

### A. APT/YUM을 이용한 설치 (Debian/RedHat 계열)

1. Elastic 저장소 추가
```bash
# Debian/Ubuntu
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
sudo apt-get install apt-transport-https
echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list

# RHEL/CentOS
sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
sudo tee /etc/yum.repos.d/elastic.repo <<EOF
[elastic-7.x]
name=Elastic repository for 7.x packages
baseurl=https://artifacts.elastic.co/packages/7.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
EOF
```

2. Logstash 설치
```bash
# Debian/Ubuntu
sudo apt-get update && sudo apt-get install logstash

# RHEL/CentOS
sudo yum install logstash
```

### B. 수동 설치 (모든 Linux 배포판)

1. 최신 버전 다운로드
```bash
wget https://artifacts.elastic.co/downloads/logstash/logstash-7.17.0-linux-x86_64.tar.gz
```

2. 압축 해제
```bash
tar -xzf logstash-7.17.0-linux-x86_64.tar.gz
cd logstash-7.17.0
```

## 4. Logstash 실행 방법

### A. 기본 실행 (수동 모드)
```bash
# 설치 경로로 이동 (수동 설치 시)
cd /usr/share/logstash  # 패키지 설치 시
# 또는 cd logstash-7.17.0 (수동 설치 시)

# 기본 파이프라인 실행
bin/logstash -e 'input { stdin { } } output { stdout {} }'
```
- `-e`: 인라인 구성 옵션
- 입력을 stdin에서 받아 stdout으로 출력하는 간단한 예제

### B. 구성 파일 사용 실행
1. 구성 파일 생성 (예: `test-pipeline.conf`)
```conf
input {
  stdin {}
}

filter {
  grok {
    match => { "message" => "%{COMBINEDAPACHELOG}" }
  }
}

output {
  stdout { codec => rubydebug }
}
```

2. 구성 파일로 실행
```bash
bin/logstash -f test-pipeline.conf
```

### C. 시스템 서비스로 실행 (패키지 설치 시)
```bash
# 시스템 시작 시 자동 실행 설정
sudo systemctl enable logstash

# Logstash 서비스 시작
sudo systemctl start logstash

# 상태 확인
sudo systemctl status logstash
```

## 5. 기본 구성 파일 위치
- 메인 설정 파일: `/etc/logstash/logstash.yml`
- 파이프라인 설정: `/etc/logstash/conf.d/`
- Java 힙 크기 설정: `/etc/logstash/jvm.options`

## 6. 로그 확인
```bash
# 로그 파일 확인
tail -f /var/log/logstash/logstash-plain.log
```

## 7. 테스트 및 검증
1. 간단한 테스트 파이프라인
```bash
echo "hello world" | bin/logstash -e 'input { stdin { } } output { stdout {} }'
```

2. 구성 파일 검증
```bash
bin/logstash -f /path/to/config.conf --config.test_and_exit
```

## 8. 성능 튜닝 (선택 사항)
- `jvm.options` 파일 수정으로 메모리 설정 조정
- 파이프라인 워커 수 조정 (`pipeline.workers` 설정)
- 배치 크기 조정 (`pipeline.batch.size` 설정)

## 9. 플러그인 관리
```bash
# 플러그인 목록 확인
bin/logstash-plugin list

# 플러그인 설치 예시
bin/logstash-plugin install logstash-filter-json

# 플러그인 업데이트
bin/logstash-plugin update
```

이상으로 Logstash의 설치 및 기본 실행 방법에 대해 설명드렸습니다. 추가로 궁금한 사항이 있으면 언제든지 질문해주세요.