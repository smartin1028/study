# Analysis of "File structure cannot be determined" Error

This error message indicates that the system is having trouble automatically determining the structure of your log file. Let me break down the key components and suggest solutions:

## Root Cause

The primary issue is that the system is trying to merge too many lines (85 lines totaling 10,023 characters) into a single message, exceeding the default limit of 10,000 characters. This typically happens when:

1. The timestamp format is incorrectly detected, causing the system to fail at recognizing message boundaries
2. You genuinely have extremely long log messages that exceed the default size limit

## Current Analysis

The system has already tried and rejected several formats:
- **Not NDJSON**: The file doesn't contain valid JSON
- **Not XML**: No XML prolog found
- **Not CSV/TSV/semicolon/pipe-delimited**: Contains unescaped quotes in fields
- **Text format**: Most likely conclusion
- **Timestamp format**: Detected as `yyyy-MM-dd HH:mm:ss.SSS` (e.g., "2024-04-28 15:45:19.536")

## Recommended Solutions

### 1. Adjust line merge settings
If your messages are genuinely this long:
```json
{
  "line_merge_size_limit": 20000
}
```
Increase this value to accommodate your longest messages.

### 2. Override timestamp detection
If the timestamp format is being misidentified:
```json
{
  "timestamp_format": "yyyy-MM-dd HH:mm:ss.SSS"
}
```
Explicitly specify the format you know to be correct.

### 3. Provide sample overrides
Based on the sample line shown, you might need to specify:
```json
{
  "format": "semi-structured text",
  "timestamp_field": "timestamp",
  "message_field": "message",
  "grok_pattern": "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{NUMBER:pid} --- \\[%{DATA:thread}\\] %{DATA:logger} : %{GREEDYDATA:message}"
}
```

### 4. Pre-process your logs
If possible, reformat your logs to:
- Ensure each log entry is on a single line
- Use proper quoting/escaping for fields containing special characters
- Add explicit delimiters if needed

## Additional Considerations

1. The error shows your logs contain Spring Boot application output with profile information ("dev-mac")
2. The system correctly detected UTF-8 encoding but with low confidence (15%) because the initial portion is ASCII
3. The unescaped quotes in log messages are preventing proper CSV/TSV detection

Would you like me to provide more specific guidance for your particular log format or help craft a more precise grok pattern for your needs?