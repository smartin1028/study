# 엘라스틱서치(Elasticsearch) 실행 후 데이터 처리 방법

## 엘라스틱서치 실행 후 데이터 얻는 방법

엘라스틱서치에서 데이터를 조회하는 주요 방법은 다음과 같습니다:

### 1. 검색 API 사용
```bash
# 기본 검색
GET /인덱스명/_search
{
  "query": {
    "match_all": {}
  }
}

# 특정 필드 검색
GET /인덱명/_search
{
  "query": {
    "match": {
      "필드명": "검색어"
    }
  }
}
```

### 2. ID로 문서 조회
```bash
GET /인덱명/_doc/문서ID
```

### 3. 쿼리 DSL 사용
```json
{
  "query": {
    "bool": {
      "must": [
        { "match": { "title": "검색" }},
        { "range": { "date": { "gte": "2023-01-01" }}}
      ]
    }
  },
  "sort": [ { "date": "desc" } ],
  "from": 0,
  "size": 10
}
```

### 4. Kibana에서 시각화 도구 사용
- Kibana의 Discover 탭에서 데이터 탐색
- 시각화(Visualize) 기능으로 차트 생성
- 대시보드(Dashboard)로 통합 관리

## 인덱스에 데이터를 넣는 방법

### 1. 단일 문서 인덱싱
```bash
PUT /인덱스명/_doc/문서ID
{
  "필드1": "값1",
  "필드2": "값2",
  "timestamp": "2023-01-01T00:00:00"
}
```

### 2. 대량 삽입 (Bulk API)
```bash
POST /_bulk
{ "index" : { "_index" : "인덱스명", "_id" : "1" } }
{ "필드1": "값1", "필드2": "값2" }
{ "index" : { "_index" : "인덱스명", "_id" : "2" } }
{ "필드1": "값3", "필드2": "값4" }
```

### 3. Logstash 사용
```conf
input {
  file {
    path => "/path/to/your/logfile.log"
  }
}

filter {
  grok {
    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:loglevel} %{GREEDYDATA:message}" }
  }
}

output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "로그인덱스-%{+YYYY.MM.dd}"
  }
}
```

### 4. Beats 사용 (Filebeat, Metricbeat 등)
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/*.log

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-%{[agent.version]}-%{+yyyy.MM.dd}"
```

### 5. 프로그래밍 언어 클라이언트 사용 (Python 예시)
```python
from elasticsearch import Elasticsearch

es = Elasticsearch(["http://localhost:9200"])

# 단일 문서 인덱싱
doc = {
    "author": "kimchy",
    "text": "Elasticsearch: cool.",
    "timestamp": "2023-01-01T00:00:00"
}
res = es.index(index="test-index", id=1, document=doc)

# 대량 삽입
actions = [
    {"_index": "test-index", "_id": 2, "_source": {"field1": "value1"}},
    {"_index": "test-index", "_id": 3, "_source": {"field1": "value2"}}
]
helpers.bulk(es, actions)
```

## 인덱스 관리 팁

1. **인덱스 템플릿** 사용:
   ```json
   PUT /_index_template/템플릿명
   {
     "index_patterns": ["logs-*"],
     "template": {
       "settings": {
         "number_of_shards": 1,
         "number_of_replicas": 1
       },
       "mappings": {
         "properties": {
           "timestamp": { "type": "date" },
           "message": { "type": "text" }
         }
       }
     }
   }
   ```

2. **별칭(Alias)** 사용:
   ```bash
   POST /_aliases
   {
     "actions": [
       { "add": { "index": "인덱스명-2023.01.01", "alias": "현재인덱스" }}
     ]
   }
   ```

3. **롤오버(Rollover)** 기능:
   ```bash
   PUT /logs-000001
   {
     "aliases": {
       "logs_write": {}
     }
   }

   POST /logs_write/_rollover
   {
     "conditions": {
       "max_age": "7d",
       "max_docs": 1000000,
       "max_size": "5gb"
     }
   }
   ```

이러한 방법들을 조합하여 엘라스틱서치에 데이터를 효율적으로 인덱싱하고 관리할 수 있습니다.